# æ–°å»ºä¸€ä¸ªspringé¡¹ç›®
## æ­¥éª¤
1. é…ç½®maven  
Â·Â·core;context;beans;experssion;commins-logging;jnuit

2. åˆ›å»ºå®ä¾‹å¯¹è±¡ï¼ˆpojoï¼‰
3. æ”¹é™æ€é…ç½®æ–‡ä»¶ï¼š resourcesä¸‹çš„xmlï¼ˆä¸€èˆ¬å‘½åä¸ºï¼šapplicationContext.xmlï¼‰
4. åˆ›å»ºç­·å­ï¼š<br>
   ApplicationContext ac=new ClassPathXmlApplicationContext("applicationContext.xml");//ç”Ÿæˆç­·å­ï¼ˆï¼‰é‡Œå¯¹åº”ä½ç½®
5. å¤¹èœï¼š<br>
   ac.getBean("potato");//å¯¹åº”xmlé‡Œçš„id   è¦å¼ºè½¬
# iocï¼ˆé¿å…åœ¨æ–¹æ³•ä»£ç ä¸­newå¯¹è±¡ï¼‰ä¸ä¾èµ–æ³¨å…¥ï¼ˆåŠ¨æ€                                                                                  ç»™åˆ›å»ºçš„å¯¹è±¡èµ‹å€¼ï¼‰




# ä¸€å¯¹å¤šæ˜ å°„
>  åœ¨ä¸€ä¸ªå¯¹è±¡ä¸­å¼•ç”¨å¦ä¸€ä¸ªå¯¹è±¡   ï¼›

> åœ¨ xmlä¸­ ä½¿ç”¨refåº”ç”¨åˆ°è¢«å¼•ç”¨å¯¹è±¡ä¸Š

# beançš„å®ä¾‹åŒ–

- æ„é€ æ–¹æ³•å®ä¾‹åŒ–
- é™æ€å·¥å‚å®ä¾‹åŒ–
- å®åŠ›å·¥å‚å®ä¾‹åŒ–

#### æ„é€ æ–¹æ³•å®ä¾‹åŒ–ï¼š

##### æ— å‚ï¼š

###### å®ä½“ç±»ï¼š

```java
public class bean1 {
    public bean1(){
        System.out.println("è¿™æ˜¯bean1ï¼");
    }
}
```

###### xmlï¼š

``` java
<bean id="bean10" class="com.beançš„å®ä¾‹åŒ–.bean1"/>
```

###### æ–¹æ³•ï¼š

```java
 @Test
    public void textwu() {
        ApplicationContext ac = new ClassPathXmlApplicationContext("applicationContext.xml");
        bean1 bean1 = ac.getBean("bean10", bean1.class);
        System.out.println(bean1);

    }
```

###### ç»“æœï¼š

```java
è¿™æ˜¯bean1ï¼
com.beançš„å®ä¾‹åŒ–.bean1@396e2f39
```

##### æœ‰å‚ï¼š

###### å®ä½“ç±»ï¼š

```java
public class bean1 {
    private String name;
    public bean1(String name){
        System.out.println("è¿™æ˜¯bean1æœ‰å‚"+name);
    }
}
```

###### xmlï¼š

``` java
<bean id="bean11" class="com.beançš„å®ä¾‹åŒ–.bean1">
       <constructor-arg name="name" value=" zch"/>
    </bean><bean id="bean10" class="com.beançš„å®ä¾‹åŒ–.bean1"/>
```

###### æ–¹æ³•ï¼š

```java
  @Test
    public void textyou() {
        ApplicationContext ac = new ClassPathXmlApplicationContext("applicationContext.xml");
        bean1 bean1 = ac.getBean("bean11", bean1.class);
        System.out.println(bean1);
    }
```

###### ç»“æœï¼š

```java
è¿™æ˜¯bean1æœ‰å‚ zch
com.beançš„å®ä¾‹åŒ–.bean1@12c8a2c0
```

##### æ³¨æ„ï¼š

>  <font color=red>xmlä¸­ä¸è¦åŒæ—¶å‡ºç°å¯¹åŒä¸€ä¸ªå®ä½“ç±»çš„é…ç½®</font>

##### æœ¬è´¨ï¼š

> ioc=>new Bean();

#### é™æ€å·¥å‚å®ä¾‹åŒ–

> åˆ›å»ºä¸€ä¸ªå·¥å…·åŒ… å·¥å…·åŒ…å¼•ç”¨ben2é™æ€æ–¹æ³•

##### æ— å‚

###### å·¥å…·åŒ…ç±»

```java
public class bean2Factory {
    //ä½¿ç”¨factoryåˆ›å»ºbean2å®ä¾‹
    public static bean2 creatbean2(){
        return  new bean2();
    }
}
```

###### bean2ç±»

```java
public class bean2 {
    public bean2(){
        System.out.println("è¿™æ˜¯bean2");
    }
}
```

###### xml

```java
<!--    é™æ€å·¥å‚å®ä¾‹åŒ–-->
<!--  ç‰¹æ®Šä¹‹å¤„ï¼š  {class}å†…å¡«å·¥å…·åŒ…{factory-method}å†™å·¥å…·åŒ…æ–¹æ³•-->
    <bean id="bean20" class="com.beançš„å®ä¾‹åŒ–.bean2Factory" factory-method="creatbean2"/>
```

###### æ–¹æ³•ï¼š

```jva
@Test
    public void textwu(){
        ApplicationContext ac=new ClassPathXmlApplicationContext("applicationContext.xml");
        bean2 bean2 = ac.getBean("bean20", bean2.class);
        System.out.println(bean2);
    }
```

###### ç»“æœï¼š

```java
è¿™æ˜¯bean2
com.beançš„å®ä¾‹åŒ–.bean2@42607a4f
```

##### æœ‰å‚

###### å·¥å…·åŒ…ç±»

```java
public class bean2Factory {
    //ä½¿ç”¨factoryåˆ›å»ºbean2å®ä¾‹
    public static bean2 creatbean21(){
        return  new bean2("czh");
    }
}
```

###### bean2ç±»

```java
public class bean2 {
    private  String name;
    public bean2(String name){
        System.out.println("è¿™æ˜¯bean2æœ‰å‚"+name);
    }
}
```

###### xml

```java
<!--    é™æ€å·¥å‚å®ä¾‹åŒ–-->
<!--  ç‰¹æ®Šä¹‹å¤„ï¼š  {class}å†…å¡«å·¥å…·åŒ…{factory-method}å†™å·¥å…·åŒ…æ–¹æ³•-->
  <!--    æœ‰å‚-->
    <bean id="bean21" class="com.beançš„å®ä¾‹åŒ–.bean2Factory" factory-method="creatbean21"/>
```

###### æ–¹æ³•ï¼š

```jva
@Test
    public void textyou(){
        ApplicationContext ac=new ClassPathXmlApplicationContext("applicationContext.xml");
        bean2 bean2 = ac.getBean("bean21", bean2.class);
        System.out.println(bean2);
    }
```

###### ç»“æœï¼š

```java
è¿™æ˜¯bean2æœ‰å‚czh
com.beançš„å®ä¾‹åŒ–.bean2@64485a47
```

##### å®è´¨ï¼š

> ioc=> MyBean2Factory.creatBean();

#### å®ä¾‹å·¥å‚å®ä¾‹åŒ–

> å…ˆåˆ›å·¥å‚ å†åˆ›å·¥å‚æ–¹æ³•

##### æ— å‚

###### å·¥å‚ç±»

```java
public class bean3Factory {
    public bean3Factory(){
        //å…ˆåˆ›å·¥å‚
        System.out.println("bean3å·¥å‚å®ä¾‹åŒ–ä¸­");
    }
    public bean3 creatbean3(){
        //åˆ›å»ºbean3å®ä¾‹çš„æ–¹æ³•
        return new bean3();
    }
}
```

###### bean3ç±»

```java
public class bean3 {
    public  bean3(){
        System.out.println("è¿™æ˜¯bean3");
    }
}
```

###### xml

```java
<!--    å®ä¾‹å·¥å‚å®ä¾‹åŒ–-->
<!--    é…ç½®å·¥å‚:åˆ©ç”¨æ„é€ å™¨å…ˆç”Ÿæˆå·¥å‚å¯¹è±¡ã€‚æ‰€ä»¥classå†™å·¥å‚-->
    <bean id="mybean3factory" class="com.beançš„å®ä¾‹åŒ–.bean3Factory"/>
<!--    ä½¿ç”¨factory-beanå±æ€§æŒ‡å‘é…ç½®çš„å®ä¾‹å·¥å‚-->
    <bean id="bean30" factory-bean="mybean3factory" factory-method="creatbean3"/>
```

###### æ–¹æ³•

```java
 @Test
    public void textwu(){
        ApplicationContext ac=new ClassPathXmlApplicationContext("applicationContext.xml");
        bean3 bean30 = ac.getBean("bean30", bean3.class);
        System.out.println(bean30);
    }
}
```

###### ç»“æœ

```java
bean3å·¥å‚å®ä¾‹åŒ–ä¸­
è¿™æ˜¯bean3
com.beançš„å®ä¾‹åŒ–.bean3@6ec8211c
```



##### æœ‰å‚

###### å·¥å‚ç±»

```java
public class bean3Factory {
    public bean3Factory(){
        //å…ˆåˆ›å·¥å‚
        System.out.println("bean3å·¥å‚å®ä¾‹åŒ–ä¸­");
    }     
    public bean3 creatbean31(){
        return new bean3("asd");//åˆ›å»ºbean3å®ä¾‹çš„æ–¹æ³•ï¼ˆæœ‰å‚ï¼‰
    }
}
```

###### bean3ç±»

```java
public class bean3 {
    private  String name;
    public  bean3(String name){
        System.out.println("è¿™æ˜¯bean3"+name);
    }
}
```

###### xml

```java
 <bean id="mybean3factory" class="com.beançš„å®ä¾‹åŒ–.bean3Factory"/>
      <bean id="bean31" factory-bean="mybean3factory" factory-method="creatbean31">
```

###### æ–¹æ³•

```java
  @Test
    public void textyou(){
        ApplicationContext ac=new ClassPathXmlApplicationContext("applicationContext.xml");
        bean3 bean31 = ac.getBean("bean31", bean3.class);
        System.out.println(bean31);
    }
```

###### ç»“æœ

```java
bean3å·¥å‚å®ä¾‹åŒ–ä¸­
è¿™æ˜¯bean3asd
com.beançš„å®ä¾‹åŒ–.bean3@6ec8211c
```

##### å®è´¨ï¼š

> ioc=> MyBean3Factory a=new MyBean3Factory();
>
> a.creatBean();

# spingä½œç”¨åŸŸ

> ```
> é…ç½®beanæ ‡ç­¾ä¸­scopeå±æ€§æ¥è®¾ç½®:
> - singleton(é»˜è®¤)å•ä¾‹
> - prototypeåŸå‹
> ```

## å•ä¾‹æ¨¡å¼

> å®¹å™¨ä¸­å®ä¾‹åŒ–ä¸€ä¸ªbeanå®ä¾‹æ¯æ¬¡è¯·æ±‚å…±äº«

##### xml

```jaca
 <bean id="bean12" class="com.beançš„å®ä¾‹åŒ–.bean1 " scope="singleton" />
```



##### æ–¹æ³•

```java
 @Test
    public void danli(){
        ApplicationContext ac = new ClassPathXmlApplicationContext("applicationContext.xml");
        bean1 bean1 = ac.getBean("bean12", bean1.class);
        bean1 bean2 = ac.getBean("bean12", bean1.class);
        bean1 bean3 = ac.getBean("bean12", bean1.class);
        System.out.println(bean1);
        System.out.println(bean2);
        System.out.println(bean3);
    }
```



##### ç»“æœ

```java
è¿™æ˜¯bean1ï¼
com.beançš„å®ä¾‹åŒ–.bean1@6ec8211c
com.beançš„å®ä¾‹åŒ–.bean1@6ec8211c
com.beançš„å®ä¾‹åŒ–.bean1@6ec8211c
```





## åŸå‹æ¨¡å¼

> è¯·æ±‚ä¸€æ¬¡å®¹å™¨ä¸­ç”Ÿæˆä¸€ä¸ª

##### xml

```jaca
<!--    åŸå‹-->
    <bean id="bean13" class="com.beançš„å®ä¾‹åŒ–.bean1 " scope="prototype" />
```



##### æ–¹æ³•

```java
 @Test
    public void åŸå‹(){
        ApplicationContext ac = new ClassPathXmlApplicationContext("applicationContext.xml");
        bean1 bean1 = ac.getBean("bean13", bean1.class);
        bean1 bean2 = ac.getBean("bean13", bean1.class);
        bean1 bean3 = ac.getBean("bean13", bean1.class);
        System.out.println(bean1);
        System.out.println(bean2);
        System.out.println(bean3);
    }
```



##### ç»“æœ

```java
è¿™æ˜¯bean1ï¼
è¿™æ˜¯bean1ï¼
è¿™æ˜¯bean1ï¼
com.beançš„å®ä¾‹åŒ–.bean1@6ec8211c
com.beançš„å®ä¾‹åŒ–.bean1@7276c8cd
com.beançš„å®ä¾‹åŒ–.bean1@544a2ea6
```

# ğŸ•å…³äºå†™ä¸€ä¸ªxmlå†™ä¸€ä¸ªæµ‹è¯•æ–¹æ³•ä¸è¿è¡Œæ–¹æ³•å®ä¾‹ä»ä¼šè¢«åˆ›å»º

## ç†è§£ï¼š

> åœ¨scope="singleton"å±æ€§ä¸‹ ä¸ä½¿ç”¨ä»ä¼šåˆ›å»ºï¼š
>
> > åœ¨è¿è¡Œå…¶ä»–æµ‹è¯•æ–¹æ³•æ—¶bean çš„å±æ€§scope="singleton"æ—¶å®ä¾‹æ–¹æ³•è¾“å‡ºè¯­å¥è¿è¡Œ
> >
> > > åœ¨æœ¬æ–‡ä¸­ä½“ç°ä¸ºegï¼šè¿è¡Œå•ä¾‹æµ‹è¯•æ–¹æ³•
> > >
> > > ```java 
> > > è¿™æ˜¯bean1ï¼
> > > è¿™æ˜¯bean1æœ‰å‚ zch
> > > è¿™æ˜¯bean2
> > > è¿™æ˜¯bean2æœ‰å‚czh
> > > bean3å·¥å‚å®ä¾‹åŒ–ä¸­
> > > è¿™æ˜¯bean3
> > > è¿™æ˜¯bean3asd
> > > è¿™æ˜¯bean1ï¼
> > > com.beançš„å®ä¾‹åŒ–.bean1@6ec8211c
> > > com.beançš„å®ä¾‹åŒ–.bean1@6ec8211c
> > > com.beançš„å®ä¾‹åŒ–.bean1@6ec8211c
> > > 
> > > ```
> > >
> > > 
>
> ä½†åœ¨scope="prototype"å±æ€§ä¸‹ ä¸ä½¿ç”¨ä¸ä¼šåˆ›å»º
>
> > åœ¨è¿è¡Œå…¶ä»–æ–¹æ³•æ—¶bean çš„å±æ€§scope="singleton"æ—¶å®ä¾‹æ–¹æ³•åœ¨æµ‹è¯•æ–¹æ³•ä¸æ¶‰åŠæ—¶ä¸è¿è¡Œè¾“å‡ºè¯­å¥
> >
> > > åœ¨æœ¬æ–‡ä»¶ä½“ç°ä¸ºè¿è¡ŒåŸå‹æµ‹è¯•æ–¹æ³•ï¼š
> > >
> > > ```java
> > > è¿™æ˜¯bean1ï¼
> > > è¿™æ˜¯bean1æœ‰å‚ zch
> > > è¿™æ˜¯bean2
> > > è¿™æ˜¯bean2æœ‰å‚czh
> > > bean3å·¥å‚å®ä¾‹åŒ–ä¸­
> > > è¿™æ˜¯bean3
> > > è¿™æ˜¯bean3asd
> > > è¿™æ˜¯bean1ï¼
> > > è¿™æ˜¯bean1ï¼
> > > è¿™æ˜¯bean1ï¼
> > > è¿™æ˜¯bean1ï¼
> > > com.beançš„å®ä¾‹åŒ–.bean1@6ec8211c
> > > com.beançš„å®ä¾‹åŒ–.bean1@7276c8cd
> > > com.beançš„å®ä¾‹åŒ–.bean1@544a2ea6
> > > ```
>
> `è¿è¡Œå•ä¾‹æ—¶åŸå‹çš„æ²¡æœ‰è¿è¡Œ`
>
> <font color=red>**ä¸€èˆ¬ClassXmlPathApplicationContextè¯»å–urlåï¼Œä¼šå°†å•ä¾‹çš„beanè¿›è¡Œé¢„ç¼–è¯‘ï¼Œç„¶åä¾èµ–æ³¨å…¥**</font>
>
> **<font color=red>singletonï¼šé»˜è®¤æˆ–è€…scopeå£°æ˜ï¼ŒSpringå®¹å™¨ä¸€æ—¦åˆ›å»ºï¼Œå°±ä¼šåˆ›å»ºæ‰€æœ‰çš„singletonçš„å¯¹è±¡ã€‚ä¸æ˜¯æ‡’åŠ è½½ï¼ˆå³ä¸æ˜¯ç”¨çš„æ—¶å€™æ‰åˆ›å»º)</font>**
> **<font color=red>prototypeï¼šåªæœ‰æ¯æ¬¡è°ƒç”¨è·å–å¯¹è±¡æ—¶å€™ï¼Œæ‰ä¼šè¢«åˆ›å»º</font>**

# beançš„è£…é…ï¼š

- åŸºäºxmlçš„è£…é…
- åŸºäºæ³¨è§£çš„è£…é…
- è‡ªåŠ¨è£…é…

## åŸºäºxmlçš„è£…é…

> - å±æ€§setteræ–¹æ³•æ³¨å…¥ 
>
> > 1. beanç±»å¿…é¡»æä¾›ä¸€ä¸ªé»˜è®¤çš„æ— å‚æ„é€ æ–¹æ³•
> >
> > 2. beanç±»å¿…é¡»ä¸ºéœ€è¦æ³¨å…¥çš„å±æ€§æä¾›å¯¹åº”çš„setteræ–¹æ³•
> >
> > 3. ## é€šè¿‡å±æ€§setteræ–¹æ³•
> >
> >    ### åœ¨å¯¹è±¡ä¸­ å®šä¹‰å¥½setæ–¹æ³• åœ¨applicationContext.xmlä¸­beanä¸­properæ ‡ç­¾é…ç½®ï¼š<br>
> >
> >    egï¼š<Â·property name="username" value="å¸¸å…†æµ·"></property>  <br>
> >    nameä¸ºpojoå¯¹è±¡çš„å±æ€§å valueä¸ºä½ è¦ç»™çš„å€¼
> >    <br>ğŸ’¥propertyå±æ€§ä¸­nameå€¼ä¸€å®šè¦ä¸setæ–¹æ³•çš„å˜é‡åç›¸åŒã€‚
>
> - æ„é€ æ–¹æ³•æ³¨å…¥
>
> > 1. ## é€šè¿‡æ„é€ æ–¹æ³•æ³¨å…¥ å®šä¹‰å¥½æ„é€ å‡½æ•°  åœ¨applicationContext.xmlä¸­beanä¸­constructor-argæ ‡ç­¾é…ç½®ï¼š<br>
> >
> >    eg:<Â·constructor-arg name="jieshao" value="è¿™æ˜¯æˆ‘çš„è‡ªæˆ‘ä»‹ç»"/><br>
> >    nameä¸ºpojoå¯¹è±¡çš„å±æ€§å valueä¸ºä½ è¦ç»™çš„å€¼<br>

## åŸºäºæ³¨è§£çš„è£…é…

### é…ç½®xmlæ–‡ä»¶

> ```xml
> <beans xmlns="http://www.springframework.org/schema/beans"
>        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
>        xmlns:context="http://www.springframework.org/schema/context"
>        xsi:schemaLocation="
>    http://www.springframework.org/schema/beans
>    http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
>    http://www.springframework.org/schema/context
>    http://www.springframework.org/schema/context/spring-context-3.0.xsd">
>     <context:component-scan base-package="com.beançš„è£…é…"/>
> </beans>
> ```

### å¸¸ç”¨æ³¨è§£

> - @Componentï¼š   æŒ‡å®šä¸€ä¸ªæ™®é€šçš„Beanï¼›   <font color=red>ï¼ˆç›¸å½“äºè¢«xmlæ–‡ä»¶å‘ç°ï¼‰@Component    //æ‹¬å·é‡Œä¸å†™å°±æ˜¯é»˜è®¤ç±»çš„é¦–å°å†™çš„å¯¹åº”å</font>
>
>   > åŠŸèƒ½ä¸Šç­‰åŒäºComponentä½†æ˜¯ç»†åŒ–çš„
>   >
>   > - @Controller æŒ‡å®šä¸€ä¸ªæ§åˆ¶å™¨ç»„ä»¶
>   > - @Service æŒ‡å®šä¸€ä¸ªä¸šåŠ¡é€»è¾‘ç»„ä»¶
>   > - @Repository æŒ‡å®šä¸€ä¸ªæ•°æ®è®¿é—®ç»„ä»¶ï¼ˆDaoï¼‰
>
> - @Scopeï¼š æŒ‡å®šä½œç”¨åŸŸï¼ˆä¸xmlåŒï¼‰
>
> - @valueï¼š æŒ‡å®šå®ä¾‹æ³¨å…¥å€¼ï¼ˆä¸xmlåŒï¼‰
>
> - @Autowiredï¼š//@Autowiredç­‰ä»·äº  @Resource(name="personDao")
>
> - @Resourceï¼šæŒ‡å®šè¦æ³¨å…¥çš„å¯¹è±¡ï¼ˆç›¸å½“äºxmlçš„refï¼‰
>
> - > beanç”Ÿå‘½å‘¨æœŸç±»ï¼š
>   >
>   > - PostConstruct: beanå®ä¾‹åˆå§‹åŒ–åè°ƒç”¨çš„æ–¹æ³•<br>PreDestoryï¼š beanå®ä¾‹é”€æ¯å‰è°ƒç”¨çš„æ–¹æ³•

#### æµ‹è¯•ä½¿ç”¨ï¼š

>æµ‹è¯•.java
>
>com/beançš„è£…é…/åŸºäºæ³¨è§£çš„è£…é…/Jobs.java
>com/beançš„è£…é…/åŸºäºæ³¨è§£çš„è£…é…/User.java
>applicationContext1.xml

## mvcæ¡ˆä¾‹ï¼š

>
>Controllerè°ƒç”¨Serviceï¼ŒServiuceè°ƒç”¨Daoï¼›Daoæ“ä½œæ•°æ®åº“

#### ç›¸å…³æ–‡ä»¶ï¼š

>com/beançš„è£…é…/åŸºäºæ³¨è§£çš„è£…é…/PersonController.java
>com/beançš„è£…é…/åŸºäºæ³¨è§£çš„è£…é…/PersonDao.java
>com/beançš„è£…é…/åŸºäºæ³¨è§£çš„è£…é…/PersonService.java
>applicationContext1.xml
>beançš„è£…é…/mvcæ¡ˆä¾‹æµ‹è¯•.java

# è‡ªåŠ¨è£…é…ï¼ˆåŸºäºxmlï¼‰

### beanå…ƒç´ ä¸­autowireå±æ€§ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®autowireçš„å€¼å®ç°è‡ªåŠ¨è£…é…

| **å±æ€§å€¼**        | **æè¿°**                                                     |
| ----------------- | ------------------------------------------------------------ |
| defaultï¼ˆé»˜è®¤å€¼ï¼‰ | ç”±<bean>çš„ä¸Šçº§å…ƒç´ <beans>çš„default-autowireå±æ€§å€¼ç¡®å®šã€‚      |
| byName            | æ ¹æ®<bean>å…ƒç´ idå±æ€§çš„å€¼è‡ªåŠ¨è£…é…ã€‚                           |
| byType            | æ ¹æ®<bean>å…ƒç´ çš„æ•°æ®ç±»å‹ï¼ˆTypeï¼‰è‡ªåŠ¨è£…é…ï¼Œå¦‚æœä¸€ä¸ªBeançš„æ•°æ®ç±»å‹ï¼Œå…¼å®¹å¦ä¸€ä¸ªBeanä¸­çš„æ•°æ®ç±»å‹ï¼Œåˆ™è‡ªåŠ¨è£…é…ã€‚ |
| constructor       | æ ¹æ®æ„é€ å‡½æ•°å‚æ•°çš„æ•°æ®ç±»å‹ï¼Œè¿›è¡ŒbyTypeæ¨¡å¼çš„è‡ªåŠ¨è£…é…ã€‚       |
| no                | é»˜è®¤å€¼ï¼Œä¸ä½¿ç”¨è‡ªåŠ¨è£…é…ï¼ŒBeanä¾èµ–å¿…é¡»é€šè¿‡<ref>å…ƒç´ æˆ–refå±æ€§å®šä¹‰ã€‚ |

#### ç›¸å…³æ–‡ä»¶ï¼š

>src/main/java/com/beançš„è£…é…/è‡ªåŠ¨è£…é…
>applicationContext.xml
>beançš„è£…é…/æµ‹è¯•.java.textä¸€å¯¹å¤šè‡ªåŠ¨è£…é…()

# beanç”Ÿå‘½å‘¨æœŸç±»ï¼š

### PostConstruct: beanå®ä¾‹åˆå§‹åŒ–åè°ƒç”¨çš„æ–¹æ³•<br>PreDestoryï¼š beanå®ä¾‹é”€æ¯å‰è°ƒç”¨çš„æ–¹æ³•

> - <font color=red>scopå–singletonæ—¶ é”€æ¯å‰åè¯­å¥å‡æ‰§è¡Œ</font>
>
> - <font color=red>å–prototypeæ—¶ é”€æ¯å‰è¯­å¥ä¸æ‰§è¡Œ</font>(Prototypeé”€æ¯æ˜¯åƒåœ¾å›æ”¶æœºåˆ¶å¤„ç†)  (springä¸­æ— æ³•è¿½è¸ª)
>
>   > Spring å®¹å™¨å¯ä»¥ç®¡ç† singleton ä½œç”¨åŸŸ Bean çš„ç”Ÿå‘½å‘¨æœŸï¼Œåœ¨æ­¤ä½œç”¨åŸŸä¸‹ï¼ŒSpring èƒ½å¤Ÿç²¾ç¡®åœ°çŸ¥é“è¯¥ Bean ä½•æ—¶è¢«åˆ›å»ºï¼Œä½•æ—¶åˆå§‹åŒ–å®Œæˆï¼Œä»¥åŠä½•æ—¶è¢«é”€æ¯ã€‚. è€Œå¯¹äº prototype ä½œç”¨åŸŸçš„ Beanï¼ŒSpring åªè´Ÿè´£åˆ›å»ºï¼Œå½“å®¹å™¨åˆ›å»ºäº† Bean çš„å®ä¾‹åï¼ŒBean çš„å®ä¾‹å°±äº¤ç»™å®¢æˆ·ç«¯ä»£ç ç®¡ç†ï¼ŒSpring å®¹å™¨å°†ä¸å†è·Ÿè¸ªå…¶ç”Ÿå‘½å‘¨æœŸã€‚. æ¯æ¬¡å®¢æˆ·ç«¯è¯·æ±‚ prototype ä½œç”¨åŸŸçš„ Bean æ—¶ï¼ŒSpring å®¹å™¨éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹ï¼Œå¹¶ä¸”ä¸ä¼šç®¡é‚£äº›è¢«é…ç½®æˆ prototype ä½œç”¨åŸŸçš„ Bean çš„ç”Ÿå‘½å‘¨æœŸã€‚.
>

# ä»£ç†åº•å±‚ï¼š

## jdkåŠ¨æ€ä»£ç†ï¼š(åˆ‡å…¥ç‚¹å­˜åœ¨æ¥å£)

### æ¡ˆä¾‹ï¼š

> ç«è½¦ç«™ä¹°ç¥¨ï¼›ä¹°ä¸äº†è¦é€šè¿‡é»„ç‰›ï¼ˆä»£ç†ï¼‰ä¹°

#### æ–°å¢åŒ…ï¼š

```xml
		 <dependency>
            <groupId>org.springframework</groupId>
            <artifactId>spring-aop</artifactId>
            <version>5.2.8.RELEASE</version>
        </dependency>
```

#### å®ç°æ–¹æ³•;

>è§jdkåŠ¨æ€ä»£ç†åŒ…
>

#### å…³é”®ç‚¹ï¼š

> - å¼•å…¥InvocationHandleræ¥å£å®ç°invokeæ–¹æ³•ï¼ˆç¡®å®šå¢å¼ºå‡ºç°çš„ä½ç½®ï¼Œreturnè¿”å›çš„Objectä¸ºåˆ‡å…¥ç‚¹æ–¹æ³•çš„è¿”å›å€¼ï¼‰<br>
>
> - ```java
>     /***
>        * @param proxy the proxy instance that the method was invoked on
>        *              åœ¨å…¶ä¸Šè°ƒç”¨æ–¹æ³•çš„ä»£ç†å®ä¾‹
>        * @param method ä»£ç†çš„æ–¹æ³•
>        * @param args åˆ‡å…¥ç‚¹çš„æ–¹æ³•å‚æ•°
>        * @return
>        * @throws Throwable
>        */
>       @Override
>       public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {
>           MyAspect myAspect = new MyAspect();
>           myAspect.queue();
>           Object invoke = method.invoke(trainStation, args);//å®ç°è¿æ¥ç‚¹æ–¹æ³•
>           myAspect.send();
>           return  invoke;
>   
>       }
>   ```
>
> - åšç›¸åº”é…ç½®ï¼ˆåˆ›å»ºä»£ç†ï¼‰ï¼š
>
> - ```java
>      public Object createProxy(TrainStation trainStation){
>   //        1.yellow çš„è‡ªæˆ‘ä¿®å…» --ClassLoader loader,
>           ClassLoader classLoader = Yellowmermer.class.getClassLoader();
>   
>   //        2.yellowçš„ä¸“ä¸šä¿®å…»ï¼ˆæœ‰å•¥åŠŸèƒ½ï¼‰ --- Class<?>[] interfaces,
>           Class[] interfaces = trainStation.getClass().getInterfaces();
>   
>   //        3.-- InvocationHandler è°ƒç”¨å¤„ç†å™¨ æ‰¾åˆ°çœŸæ­£æ–¹æ³•
>           this.trainStation=trainStation;
>           return Proxy.newProxyInstance(classLoader,interfaces,this);
>   ```
>
>   <font color=red >**æ–¹æ³•è¦ Object**</font>

## CGlibä»£ç†ï¼šï¼ˆå¯¹æ™®é€šç±»ä»£ç†ï¼‰

ä»£ç†ç±»çš„é…ç½®ï¼š

>```java
>public class CGlibProxy implements MethodInterceptor {
>    public  Object craetProxy (TrainStation trainStation){
>        Enhancer enhancer =new Enhancer();//1.åˆ›å»ºä¸€ä¸ªåŠ¨æ€ç±»å¯¹è±¡ï¼ˆå®ƒå¯ä»¥è‡ªåŠ¨åˆ›å»ºå­ç±»å®ç°ç»§æ‰¿å¼çš„ä»£ç†ï¼‰
>        enhancer.setSuperclass(trainStation.getClass());///3. ç¡®å®šè¦å¢å¼ºçš„ç±»ï¼Œè®¾ç½®å…¶çˆ¶ç±»
>        enhancer.setCallback(this);//4.æ·»åŠ å›è°ƒå‡½æ•°ï¼ˆç±»ä¼¼æ‹¦æˆªå™¨ ï¼Œå°†åˆ‡å…¥ç‚¹å‡½æ•°æ‹¦æˆªä¸‹æ¥åæ·»åŠ å¢å¼ºï¼‰
>        return enhancer.create();//2.è¿”å›åˆ›å»ºçš„ä»£ç†ç±»
>    }
>
>    /***
>     * æ‹¦æˆªå™¨æ‹¦ä½å è¦ä¸è¦æ·»åŠ å¢å¼º
>     * @param o ä»£ç†å¯¹è±¡
>     * @param method çœŸæ­£è®¿é—®çš„ç›®æ ‡å¯¹è±¡çš„æ–¹æ³•
>     * @param objects è®¿é—®æ—¶ä¼ çš„å‚
>     * @param methodProxy ä»£ç†çš„æ–¹æ³•
>     * @return  o1 åˆ‡å…¥ç‚¹æ–¹æ³•çš„è¿”å›å€¼
>     * @throws Throwable
>     */
>    @Override
>    public Object intercept(Object o, Method method, Object[] objects, MethodProxy methodProxy) throws Throwable {
>        MyAspect myAspect=new MyAspect();//3.æ·»åŠ å¢å¼º
>        myAspect.queue();
>        Object o1 = methodProxy.invokeSuper(o, objects);//1.ä»¥ä»£ç†çš„æ–¹æ³•æ‰¾çˆ¶ç±»çš„æ–¹æ³•
>        myAspect.send();
>        return o1;//2.o1ä¸ºåˆ‡å…¥ç‚¹æ–¹æ³• çš„è¿”å›å€¼
>    }
>}
>```
>
>
>
>

# AspectJç¼–ç¨‹

###### å¼•å…¥åŒ…

```xml
<!-- aspectjrtåŒ…çš„ä¾èµ– -->
<dependency>
     <groupId>org.aspectj</groupId>
     <artifactId>aspectjrt</artifactId>
     <version>1.9.1</version>	
</dependency>
<!-- aspectjweaveråŒ…çš„ä¾èµ– -->
<dependency>
     <groupId>org.aspectj</groupId>
     <artifactId>aspectjweaver</artifactId>
     <version>1.9.6</version>	
</dependency>

```



## åŸºäºxmlå®ç°aop

### xmlçš„åˆ›å»º

> ```xml
> <beans xmlns="http://www.springframework.org/schema/beans"
>        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
>        xmlns:aop="http://www.springframework.org/schema/aop"
>        xsi:schemaLocation="
>    http://www.springframework.org/schema/beans
>    http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
>    http://www.springframework.org/schema/aop 
>    http://www.springframework.org/schema/context/spring-aop-3.0.xsd">
>  <aop:config>
>      
>  </aop:config>
> 
> </beans>
> ```

### é…ç½®Spring AOPçš„XMLå…ƒç´  

| **å…ƒç´ **              | **æè¿°**                                                     |
| --------------------- | ------------------------------------------------------------ |
| <aop:config>          | Spring  AOPé…ç½®çš„æ ¹å…ƒç´                                       |
| <aop:aspect>          | é…ç½®åˆ‡é¢                                                     |
| <aop:advisor>         | é…ç½®é€šçŸ¥å™¨                                                   |
| <aop:pointcut>        | é…ç½®åˆ‡ç‚¹  :åˆ‡å…¥ç‚¹æ˜¯é€šè¿‡<aop:pointcut>å…ƒç´ æ¥å®šä¹‰çš„ã€‚å½“<aop:pointcut>å…ƒç´ ä½œä¸º<aop:config>å…ƒç´ çš„å­å…ƒç´ å®šä¹‰æ—¶ï¼Œè¡¨ç¤ºè¯¥åˆ‡å…¥ç‚¹æ˜¯å…¨å±€çš„ï¼Œå®ƒå¯è¢«å¤šä¸ªåˆ‡é¢å…±äº«ï¼›å½“<aop:pointcut>å…ƒç´ ä½œä¸º<aop:aspect>å…ƒç´ çš„å­å…ƒç´ æ—¶ï¼Œè¡¨ç¤ºè¯¥åˆ‡å…¥ç‚¹åªå¯¹å½“å‰åˆ‡é¢æœ‰æ•ˆã€‚å®šä¹‰<aop:pointcut>å…ƒç´ æ—¶ï¼Œé€šå¸¸ä¼šæŒ‡å®šidã€expressionå±æ€§ã€‚ |
| <aop:before>          | é…ç½®å‰ç½®é€šçŸ¥,åœ¨ç›®æ ‡æ–¹æ³•æ‰§è¡Œå‰å®æ–½å¢å¼º,å¯ä»¥åº”ç”¨äºæƒé™ç®¡ç†ç­‰åŠŸèƒ½ |
| <aop:after>           | é…ç½®åç½®é€šçŸ¥,åœ¨ç›®æ ‡æ–¹æ³•æ‰§è¡Œåå®æ–½å¢å¼º,å¯ä»¥åº”ç”¨äºå…³é—­æµã€ä¸Šä¼ æ–‡ä»¶ã€åˆ é™¤ä¸´æ—¶æ–‡ä»¶ç­‰åŠŸèƒ½ |
| <aop:around>          | é…ç½®ç¯ç»•æ–¹å¼,åœ¨ç›®æ ‡æ–¹æ³•æ‰§è¡Œå‰åå®æ–½å¢å¼º,å¯ä»¥åº”ç”¨äºæ—¥å¿—ã€äº‹åŠ¡ç®¡ç†ç­‰åŠŸèƒ½ |
| <aop:after-returning> | é…ç½®è¿”å›é€šçŸ¥,åœ¨ç›®æ ‡æ–¹æ³•æˆåŠŸæ‰§è¡Œä¹‹åè°ƒç”¨é€šçŸ¥                  |
| <aop:after-throwing>  | é…ç½®å¼‚å¸¸é€šçŸ¥,åœ¨æ–¹æ³•æŠ›å‡ºå¼‚å¸¸åå®æ–½å¢å¼º,å¯ä»¥åº”ç”¨äºå¤„ç†å¼‚å¸¸è®°å½•æ—¥å¿—ç­‰åŠŸèƒ½ |



<aop:aspect>å…ƒç´ çš„idå±æ€§å’Œrefå±æ€§çš„æè¿°

| **å±æ€§åç§°** | **æè¿°**                   |
| ------------ | -------------------------- |
| id           | ç”¨äºå®šä¹‰è¯¥åˆ‡é¢çš„å”¯ä¸€æ ‡è¯†   |
| ref          | ç”¨äºå¼•ç”¨æ™®é€šçš„Spring  Bean |

<aop:pointcut>å…ƒç´ çš„idå±æ€§å’Œexpressionå±æ€§æè¿°

| **å±æ€§åç§°** | **æè¿°**                                                     |
| ------------ | ------------------------------------------------------------ |
| id           | ç”¨äºæŒ‡å®šåˆ‡å…¥ç‚¹çš„å”¯ä¸€æ ‡è¯†                                     |
| expression   | ç”¨äºæŒ‡å®šåˆ‡å…¥ç‚¹å…³è”çš„åˆ‡å…¥ç‚¹è¡¨è¾¾å¼ <br> execution(modifiers-pattern?ret-type-pattern declaring-type-pattern?name-pattern(param-pattern) throws-pattern?)<br>modifiers-patternï¼šè¡¨ç¤ºå®šä¹‰çš„ç›®æ ‡æ–¹æ³•çš„è®¿é—®ä¿®é¥°ç¬¦ï¼Œå¦‚publicã€privateç­‰ã€‚<br>ret-type-patternï¼šè¡¨ç¤ºå®šä¹‰çš„ç›®æ ‡æ–¹æ³•çš„è¿”å›å€¼ç±»å‹ï¼Œå¦‚voidã€Stringç­‰ã€‚<br><font color =yellow>ä¸€èˆ¬modifiers-pattern?ret-type-patternè¿™ä¸¤é¡¹çš„å€¼ä¸ºï¼š'âœ³'</font><br>declaring-type-patternï¼šè¡¨ç¤ºå®šä¹‰çš„ç›®æ ‡æ–¹æ³•çš„ç±»è·¯å¾„ï¼Œå¦‚com.itheima.jdk.UserDaoImplã€‚<br>name-patternï¼šè¡¨ç¤ºå…·ä½“éœ€è¦è¢«ä»£ç†çš„ç›®æ ‡æ–¹æ³•ï¼Œå¦‚add()æ–¹æ³•ã€‚å…¨éƒ¨ä¸º*<br>param-patternï¼šè¡¨ç¤ºéœ€è¦è¢«ä»£ç†çš„ç›®æ ‡æ–¹æ³•åŒ…å«çš„å‚æ•°ï¼Œæœ¬ç« ç¤ºä¾‹ä¸­ç›®æ ‡æ–¹æ³•å‚æ•°éƒ½ä¸ºç©ºã€‚å…¨éƒ¨ä¸ºï¼ˆ..ï¼‰<br>throws-patternï¼šè¡¨ç¤ºéœ€è¦è¢«ä»£ç†çš„ç›®æ ‡æ–¹æ³•æŠ›å‡ºçš„å¼‚å¸¸ç±»å‹ã€‚ |





## åŸºäºæ³¨è§£å®ç°aop

| **å…ƒç´ **        | **æè¿°**     |
| --------------- | ------------ |
| @Aspect         | é…ç½®åˆ‡é¢     |
| @Pointcut       | é…ç½®åˆ‡ç‚¹     |
| @Before         | é…ç½®å‰ç½®é€šçŸ¥ |
| @After          | é…ç½®åç½®é€šçŸ¥ |
| @Around         | é…ç½®ç¯ç»•æ–¹å¼ |
| @AfterReturning | é…ç½®è¿”å›é€šçŸ¥ |
| @AfterThrowing  | é…ç½®å¼‚å¸¸é€šçŸ¥ |

### xmlçš„é…ç½®

```xml
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:aop="http://www.springframework.org/schema/aop"
       xsi:schemaLocation="
   http://www.springframework.org/schema/beans
   http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
   http://www.springframework.org/schema/aop
   http://www.springframework.org/schema/aop/spring-aop-3.0.xsd">
    <bean id="myaspect" class="com.AspectJç¼–ç¨‹.åŸºäºæ³¨è§£å®ç°aop.aspect.MyAspect"/>
    <bean id="trainstation" class="com.AspectJç¼–ç¨‹.åŸºäºæ³¨è§£å®ç°aop.target.TrainStation"/>
<!--    è‡ªåŠ¨æ‰«æ-->
    <aop:aspectj-autoproxy/>
</beans>
```

#### <font color=red>æ³¨æ„ï¼šç¯ç»•é€šçŸ¥è¿”å›å€¼å¿…é¡»ä¸º  object å¹¶å¼•å…¥ProceedingJoinPoint proceedingJoinPointå‚æ•°</font>

>```java
>public Object around(ProceedingJoinPoint proceedingJoinPoint) throws Throwable {
>    queue();//å‰
>    //æ–¹æ³•ï¼š ï¼ˆä¸åº•å±‚çš„å®ç° é€»è¾‘ç›¸åŒï¼‰
>    Object proceed = proceedingJoinPoint.proceed();
>    send();//å
>    return "è¿™æ˜¯ç¯ç»•é€šçŸ¥çš„è¿”å›å€¼"+proceed;
>}
>```
>
>ç¯ç»•æ–¹æ³•çš„ä¹¦å†™
>
>```java
>//å‰
>//åˆ‡å…¥ç‚¹æ–¹æ³•
>//å
>```

æ³¨æ„ï¼šxmlgæˆ–æ³¨è§£aopæ—¶ï¼›æœ‰æ¥å£ç”¨æ¥å£è·å–è¿”å›å€¼ï¼ˆæœ‰æ¥å£é»˜è®¤jdkaopï¼‰
